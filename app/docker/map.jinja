{% set docker = salt['grains.filter_by']({
  'Windows': {
    'package': 'docker-desktop',
    'installer': 'chocolatey.installed'
  },
  'default': {
    'package': 'docker',
    'installer': {
        'pkg.installed': [
          {
            'pkgs': [
              'docker',
              'docker-compose'
            ],
          },
        ]
      }
  },
}, grain="os_family", default='default', merge=salt['grains.filter_by']({
  'Ubuntu': {
    'installer': {
      'pkgrepo.managed': [{
        'name': 'deb [signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu ' ~ salt.grains.get('oscodename') ~ ' stable',
        'file': '/etc/apt/sources.list.d/docker.list',
        'key_url': 'https://download.docker.com/linux/ubuntu/gpg',
        'aptkey': False
      }],
      'pkg.installed': [
        {
          'pkgs': [
            'docker-ce',
            'docker-ce-cli',
            'containerd.io',
            'docker-buildx-plugin',
            'docker-compose-plugin',
          ]
        },
      ],
    },
  },
}, grain='os', merge=salt['pillar.get']('docker:lookup'))) %}
